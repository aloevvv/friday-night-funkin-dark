<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">  
<title>FNF: Dark Minds</title>
<link rel="icon" type="image/png" href="favicon.png" />
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: black;
        font-family: sans-serif;
    }

    @font-face {
    font-family: "Blue Winter";
    src: url("fonts/Blue-Winter.ttf") format("truetype");
}
@font-face {
    font-family: "Docallisme";
    src: url("fonts/DOCALLISMEONSTREET.ttf") format("truetype");
}
    .gradient-text {
    background: linear-gradient(90deg, #ff4d4d, #ffa64d, #ffff4d);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

    #loading-screen {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: opacity 1s ease;
}

#title-screen {
    position: absolute;
    inset: 0;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    transition: opacity 1s ease;
}
#title-buttons {
    position: absolute;
    bottom: 10%;
    right: 70%;
    display: flex;
    flex-direction: column;
    gap: 20px;
    align-items: center;
    opacity: 0; 
    pointer-events: none;
    transition: opacity 0.8s ease;
}

.menu-btn {
    font-family: "Blue Winter", sans-serif;
    text-align: center;
    font-size: 32px;
    width: 200px;
    padding: 14px 10px;
    background: rgba(70,13,13,0.9);
    color: white;
    border: 3px solid black;
    border-radius: 10px;
    cursor: pointer;
    transition: transform 0.15s cubic-bezier(0.2, 0.8, 0.4, 1),
                box-shadow 0.15s ease,
                background 0.15s ease;
    transform-origin: center;
}

.menu-btn:hover {
    transform: scale(1.12);
    background: rgba(255,255,255,0.2);
    box-shadow: 0 0 18px rgba(255,255,255,0.6);
}

    #loading-text {
        color: white;
        font-size: 100px;
        margin-bottom: 20px;
        text-shadow: 0 0 10px black;
        font-family: "Docallisme";
    }

    #progress-container {
        width: 60%;
        height: 20px;
        background: rgba(255,255,255,0.2);
        border-radius: 10px;
        overflow: hidden;
    }

    #progress-bar {
        width: 0%;
        height: 100%;
        background: white;
        transition: width 0.2s linear;
    }
    
    .flash {
    animation: flashAnim 2.5s infinite ease-in-out;
}

@keyframes flashAnim {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}
    
.fade-in {
    animation: fadeInAnim 1s forwards ease;
}

@keyframes fadeInAnim {
    from { opacity: 0; }
    to { opacity: 0.8; }
}

    #disclaimer-screen {
    position: absolute;
    inset: 0;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 1s ease;
    text-align: center;
    padding: 20px;
    color: white;
}

#disclaimer-text {
    font-family: "Blue Winter";
    position: absolute;
    font-size: 24px;
    max-width: 800px;
    top: 30%;
    margin-bottom: 20px;
}

#press-enter {
    position: absolute;
    font-size: 18px;
    opacity: 0;
    top: 60%
}

    #title-screen {
        opacity: 0;
        pointer-events: none;
    }
</style>
</head>
<body>

<div id="loading-screen" style="background-image: url('backgrounds/loading.png');">
    <div id="loading-text" class="gradient-text fade-in">LOADING...</div>
    <div id="progress-container">
        <div id="progress-bar"></div>
    </div>
</div>

<div id="disclaimer-screen" style="background-image: url('backgrounds/disclaimer.png');">
    <div id="disclaimer-text"></div>
    <div id="press-enter">Press [ENTER] to continue</div>
</div>

<div id="title-screen" style="background-image: url('backgrounds/title.png');"></div>
<div id="title-buttons">
    <button class="menu-btn" id="btn-play">Play</button>
    <button class="menu-btn" id="btn-continue">Continue</button>
    <button class="menu-btn" id="btn-settings">Settings</button>
</div>

    <div id="dialog-overlay" style="display:none; position:fixed; inset:0; z-index:2500; background:rgba(0,0,0,0.6); align-items:flex-end; justify-content:center; padding:20px;">
  <div id="dialog-box" style="background:#0e2057; color:white; border:2px solid black; padding:16px; max-width:640px; font-family:'Press Start 2P',sans-serif;">
    <div id="dialog-text" style="white-space:pre-wrap; font-size:12px; line-height:1.2;"></div>
    <div style="text-align:right; margin-top:8px;">
      <button id="dialog-next" style="font-family:'Blue Winter',sans-serif; padding:8px 12px;">Next</button>
    </div>
  </div>
</div>



<script>

    const assets = [
        "backgrounds/title.png",
        "backgrounds/loading.png",
        "backgrounds/disclaimer.png"
    ];

    let loaded = 0;

    function preloadAsset(src) {
        return new Promise((resolve) => {
            let element;

            if (src.endsWith(".png") || src.endsWith(".jpg")) {
                element = new Image();
                element.onload = resolve;
                element.src = src;
            } else {
                element = new Audio();
                element.oncanplaythrough = resolve;
                element.src = src;
                element.load();
            }
        });
    }

    async function preloadAll() {
    for (const src of assets) {
        await preloadAsset(src);
        loaded++;

        const percent = Math.floor((loaded / assets.length) * 100);
        document.getElementById("progress-bar").style.width = percent + "%";
    }

    document.getElementById("loading-text").textContent = "LOADED!";
    await new Promise(r => setTimeout(r, 1000));

    document.getElementById("loading-screen").style.opacity = 0;

    setTimeout(showDisclaimer, 1000);
}

const disclaimerText = `
This game contains content that may not be suitable for everyone.
Such topics include emotional abuse and toxic relationships.
It is an AU, so characters may act out of character.
With that, enjoy at your comfort.
`;

document.getElementById("disclaimer-text").textContent = disclaimerText;
document.getElementById("disclaimer-text").classList.add("flash");

let disclaimerActive = false;

async function showDisclaimer() {
    const d = document.getElementById("disclaimer-screen");
    d.style.opacity = 1;
    d.style.pointerEvents = "auto";
    disclaimerActive = true;
    
    setTimeout(() => {
        document.getElementById("press-enter").classList.add("fade-in");
    }, 2000);
}

    
    document.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && disclaimerActive) {
        disclaimerActive = false;

        const d = document.getElementById("disclaimer-screen");
        d.style.opacity = 0;
        d.style.pointerEvents = "none";
        
        setTimeout(() => {
            document.getElementById("title-screen").style.opacity = 1;
            setTimeout(() => {
                const buttons = document.getElementById("title-buttons");
                buttons.style.opacity = 1;
                buttons.style.pointerEvents = "auto";
            }, 300);

        }, 1000);
    }
});


    preloadAll();
    
    // below i will yoink things from my previous game

    let gameFlags = {
        placeholder: false,
        place: false
    };
    
    const speakerConfigs = {
  'guy': { speed: 30, pitch: 1.0, frequency: 2, sound: 'blip.wav' },
  'default': { speed: 30, pitch: 1.0, frequency: 2, sound: 'blub2.mp3' }
};

const shownDialogs = new Set();
let _dialogQueue = [];
let _typingInterval = null;
let _isTyping = false;
let _fullTextToDisplay = "";
let _currentSpeaker = null;
let _currentEffect = null;
let _currentOnFinish = null;

    function startTypewriter(text, element, speaker = null, effect = null, onFinish = null) {
  clearInterval(_typingInterval);
  _isTyping = true;
  _fullTextToDisplay = text;
  _currentSpeaker = speaker;
  _currentEffect = effect;
  _currentOnFinish = onFinish;

  const config = speakerConfigs[speaker] || speakerConfigs['default'];
  const charSound = new Audio(config.sound);
  charSound.volume = 0.5;

  let i = 0;
  element.innerHTML = speaker ? `<strong>${speaker}</strong>\n\n` : "";

  _typingInterval = setInterval(() => {
    if (i < text.length) {
      const char = text.charAt(i);
      const span = document.createElement('span');
      span.className = 'dialog-char';
      span.textContent = char;
      if (effect === 'shaky') span.classList.add('effect-shake');
      if (effect === 'sine' || effect === 'wave') {
          span.classList.add('effect-wave');
          span.style.animationDelay = (i * 0.1) + 's';
      }
      if (effect === 'glitch') span.classList.add('effect-glitch');
      element.appendChild(span);

      if (i % config.frequency === 0) {
        const playClone = charSound.cloneNode();
        playClone.playbackRate = config.pitch;
        playClone.play().catch(e => {});
      }
      i++;
    } else {
      finishTyping(element, onFinish);
    }
  }, config.speed);
}

function finishTyping(element, onFinish = null) {
  clearInterval(_typingInterval);
  _isTyping = false;
  
  element.innerHTML = _currentSpeaker ? `<strong>${_currentSpeaker}</strong>\n\n` : "";
  for (let i = 0; i < _fullTextToDisplay.length; i++) {
    const span = document.createElement('span');
    span.className = 'dialog-char';
    span.textContent = _fullTextToDisplay[i];
    if (_currentEffect === 'shaky') span.classList.add('effect-shake');
    if (_currentEffect === 'sine' || _currentEffect === 'wave') {
        span.classList.add('effect-wave');
        span.style.animationDelay = (i * 0.1) + 's';
    }
    if (_currentEffect === 'glitch') span.classList.add('effect-glitch');
    element.appendChild(span);
  }
  if (onFinish) onFinish();
}

function normalizeDialogLines(textOrLines, defaultStyle) {
  const lines = Array.isArray(textOrLines) ? textOrLines.slice() : [String(textOrLines)];
  return lines.map(line => {
    if (typeof line === 'string') {
      return { speaker: null, text: line, style: defaultStyle || 'dialog', effect: null };
    }
    return {
      speaker: line.speaker || null,
      text: line.text != null ? String(line.text) : '',
      style: line.style || defaultStyle || 'dialog',
      effect: line.effect || null
    };
  });
}

function applyDialogStyle(box, style) {
  box.style.maxWidth = '640px';
  box.style.fontSize = '12px';
  if (style === 'other') {
    box.style.background = '#223344';
    box.style.fontSize = '14px';
  } else if (style === 'a') {
    box.style.background = '#78bdff';
    box.style.fontSize = '14px';
  } else if (style === 'npc') {
    box.style.background = '#b7b7b7';
    box.style.fontSize = '14px';
  } else if (style === 'unit') {
    box.style.background = '#4c4c4c';
    box.style.fontSize = '14px';
  } else if (style === 'boss') {
    box.style.background = '#330000';
    box.style.fontSize = '12px';
    } else if (style === 'd') {
    box.style.background = '#ca2f2f';
    box.style.fontSize = '12px';
  } else {
    box.style.background = '#0e2057';
    box.style.fontSize = '12px';
  }
}

function showDialogWithOptions(dialogText, options, idToMark, opts = {}) {
  const overlay = document.getElementById('dialog-overlay');
  const box = document.getElementById('dialog-box');
  const textDiv = document.getElementById('dialog-text');
  const nextBtn = document.getElementById('dialog-next');

  overlay.style.display = 'flex';
  overlay._markId = idToMark || null;
  nextBtn.style.display = 'none';

  applyDialogStyle(box, opts.style || 'dialog');

  startTypewriter(dialogText, textDiv, opts.speaker || null, opts.effect, () => {
    textDiv.appendChild(document.createElement('br'));
    textDiv.appendChild(document.createElement('br'));

    options.forEach(opt => {
      const btn = document.createElement('button');
      btn.textContent = opt.label;
      btn.className = 'item-use-button';
      btn.style.margin = '8px 10px 0 0';
      btn.style.padding = '8px 16px';
      btn.style.fontSize = '14px';
      btn.onclick = () => {
        overlay.style.display = 'none';
        if (opt.onSelect) opt.onSelect();
        if (idToMark) shownDialogs.add(idToMark);
        draw();
      };
      textDiv.appendChild(btn);
    });
  });
}

function showDialog(textOrLines, idToMark, opts = {}) {
  document.getElementById('dialog-next').style.display = 'inline-block';
  const overlay = document.getElementById('dialog-overlay');
  const box = document.getElementById('dialog-box');
  const textDiv = document.getElementById('dialog-text');
  const defaultStyle = opts.style || 'dialog';

  overlay.style.display = 'flex';
  _dialogQueue = normalizeDialogLines(textOrLines, defaultStyle);

  if (_dialogQueue.length > 0) {
    const line = _dialogQueue.shift();
    applyDialogStyle(box, line.style);
    
    startTypewriter(line.text, textDiv, line.speaker, line.effect);
  }
  
  overlay._markId = idToMark || null;
  overlay._onComplete = opts.onComplete || null; 
  draw();
}

   // later 
function closeDialog() {
    const overlay = document.getElementById("dialog-overlay");
    const textDiv = document.getElementById("dialog-text");

    overlay.style.display = "none";
    textDiv.innerHTML = "";

    _isTyping = false;
    clearInterval(_typingInterval);

    if (overlay._markId) {
        shownDialogs.add(overlay._markId);
        overlay._markId = null;
    }

    if (overlay._onComplete) {
        overlay._onComplete();
        overlay._onComplete = null;
    }

    draw();
}
function draw() {
    //nothing
}
    
</script>

</body>
</html>
